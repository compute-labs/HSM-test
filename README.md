# Hardware security module  application testing on AMD EPYC server Processor - Test
## Table of Contents
- [Badges](#badges)
- [Application Overview](#application-overview)
  - [Message Encryption and Storage](#message-encryption-and-storage)
  - [Secure Configuration Management](#secure-configuration-management)
- [Working Image](#working-image)
- [Use Case Illustration](#use-case-illustration)

![Testing](https://img.shields.io/badge/Testing-Workaround%20Done-green?logo=check-circle)
![Profiling](https://img.shields.io/badge/Profiling-Ongoing-yellow?logo=hourglass-half)
![Security](https://img.shields.io/badge/Security-In%20Progress-yellow?logo=shield-alt)


## Application Functionality Overview
```
+-------------------------------------------------------------------+  
|        Guest VM running  AMD SEV SEV-ES SEV-SNP                   |
| SEV-SNP ensures that all computations are encrypted within memory.|
|    + within virtual machine +   Secure nested page                |
| +-------------------+     +------------------------------------+  |   
| | Python App        |     | .env.aes File                      |  | 
| |                   |     | (Stored on Back store)             |  | 
| | - Receives POS    |     | - POSTGRES_USER=...                |  | 
| |   data via POST   |     | - POSTGRES_PASSWORD=...            |  |  
| | - Encrypts data   |     | - SECRET_KEY=...                   |  |   
| |   with ASP-       |     |                                    |  |  
| |   derived key     |     |                                    |  |  
| | - Pushes encrypted|     |                                    |  |  
| |   data to database|     |                                    |  |   
| | - Pushes encrypted|     |                                    |  | 
| |   data to S3      |     +------------------------------------+  |   
| |                   |                 |                           |   
| | - Uses .env       |                 | Encrypted using           |  
| |   variables       |                 | ASP-derived key           | 
| +-------------------+                 |  256-bit CBC              |  
|                                       V                           |  
| (startup.sh copies .env into App directory)                       | 
+-------------------------------------------------------------------+
                                  |
                                  V 
The entire application is under the governance of a key derived from an ASP(AMD Secure Processor)

```
- Our application offers robust encryption and decryption capabilities, tailored for secure message handling and configuration management. Here's how it works:

### Message Encryption and Storage:

- **Inbound Message Handling**: All incoming messages received via the POST method are encrypted.
- **Secure Storage**: The encrypted messages are then securely stored in both our backend database and AWS S3 storage.
Message Decryption:

- **Retrieval and Decryption**: Encrypted messages stored in the database can be decrypted using the GET method.
- This decryption process utilizes a key derived from our Application Specific Processor (ASP), specifically the Versioned Chip Endorsement Key (VCEK).
### Secure Configuration Management:

- **.env.aes File Handling**: 
- The application also decrypts the encrypted .env.aes file (located in the backend store) when it's loaded into the application.
- In-Memory Processing: This decryption occurs in-memory (DRAM), using the same ASP-derived key.
- The entire operation of the app is governed by the unique key generated by the Versioned Chip Endorsement Key, ensuring high-level security and integrity of data handling processes.
### Working image
![Example Image](https://github.com/compute-labs/HSM-test/blob/a78d90fff4fad127f048661fe32c488f8be92f26/PoC.png)

## Use case  Illustration
![Security Log Example](https://github.com/compute-labs/HSM-test/blob/master/Bots%26ScriptAttacks.png)
- Here on our AWS-hosted application in image is frequently targeted by bots and automated scripts searching for the .env file. However, due to our robust encryption, any sensitive information remains secure against unauthorized access. 
- To ensures the protection of sensitive credentials and data by employing 256-bit CBC (Cipher Block Chaining) encryption.
- This security measure is particularly crucial in the event of a web server compromise or if the AWS security services are breached.
- If your data is deleted from AWS S3, neither AWS, any other storage service, nor an attacker with database access can read your sensitive data. This is because decrypting it without the encryption key would take thousands of years 
